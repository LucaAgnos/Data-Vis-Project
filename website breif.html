<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8"/>
	<meta name="description"	content="Visualisation Assignment"/>
	<meta name="keywords"		  content="HTML, CSS"/>
	<meta name="author"			  content="Luca Agnos"/>

    <link rel="stylesheet" href="style.css">

    <script src="https://d3js.org/d3.v7.min.js"></script>

	<title>Migration</title>

</head>
<body>
    <h1>Migration in Europe</h1>

         <div class="navbar">
    <a href="#introduction"> Introduction</a> 
    <a href="#body"> The Data</a> 
    <a href="#conclusion"> Conclusion</a> 
    <a href="#references"> References</a> 
    <p>Will Add More Soon</p>
    </div>


        <h2> Overview</h2>
        <p>
            (once gathered info will complete)
        </p>

        <h2 id="introduction"> Introduction</h2>

        <p> How our introduction will go, what is below is an example from my cost of living</p> 
        <p> The cost of living is the amount of money that is needed to cover the basic essentials for survival. These can be things such as housing, healthcare, food and taxes. 
            I have decided to do some research into Singapore to see how they have been struggling with the cost of living due to certain events making it harder to cover the essentials.
            My goals are trying to find out what is Singapore's cost of living and what are the reasons for it to be that.
            To showcase how and why the cost of living has impacted them, I will be using data visualisation to express the data in a visual way rather than reading numbers that don't mean anything while they're by themselves.
            To start off, I will be presenting a dot chart, highlighting were Singapore is located compared to the rest of the world with it's Cost of Living index and the local purchasing power. 
            Next is a bar graph to empathise why Singapore's cost of living is high by presenting the monthly cost for a a single person with/without rent, a couple and a family of 4 and finding out why those are the prices.
            Lastly, I have a pie chart that covers the average cost of living in Singapore and finding out what expenses have higher priority than others and seeing if it connects with reasons for why the cost of living is high.
            This data visualisation is meant for all audiences to help understand why Singapore's cost of living is high by having a graph and explaining what the graph means.
        </p>

        <h2 id="body"> The data</h2>

        <p> Example </p>

        <h1>Europe</h1>

    <div>
      <label for="year">Select year:</label>
      <select id="year">
        <option value="2012">2012</option>
        <option value="2013">2013</option>
        <option value="2014">2014</option>
        <option value="2015">2015</option>
        <option value="2016">2016</option>
        <option value="2017">2017</option>
        <option value="2018">2018</option>
        <option value="2019">2019</option>
        <option value="2020">2020</option>
        <option value="2021">2021</option>
      </select>
    </div>
  <br>
    <div id="legend-container"></div>
    <div id="tooltip" style="display:none"></div>
    <div id="map-container">
      <svg id="map"></svg>
    </div>
  
         <script>
// Set the width and height of the SVG container
var width = 960;
var height = 960;

// Create a Mercator projection with a centered location and scale
var projection = d3.geoMercator()
  .center([10, 50])
  .translate([width / 2, height / 2])
  .scale(600);

// Create a path generator using the projection
var path = d3.geoPath()
  .projection(projection);

// Create an SVG container in the "map-container" div with the specified width and height
var svg = d3.select("#map-container")
  .append("svg")
  .attr("width", width)
  .attr("height", height);

// Define a color scale
var color = d3.scaleSequential(d3.interpolateGreens);

// Load the Europe GeoJSON file and the cleaned CSV data
d3.json("europe.json").then(json => {
  d3.csv("cleaned_whole_set.csv").then(csvData => {   
    // Set the initial selected year
    var selectedYear = "2012";

    // Filter the data to only include the selected year
    var filteredData = csvData.filter(d => d.TIME_PERIOD == selectedYear);

    // Group the data by country code
    var dataMap = d3.group(filteredData, d => d.geo);

    // Convert the dataMap to an array of objects
    var data = Array.from(dataMap, ([geo, values]) => ({
      geo: geo,
      value: +values[0].value
    }));

    // Set the color scale domain based on the data values
    color.domain(d3.extent(data, d => d.value));

    // Bind the GeoJSON features to path elements and set their fill color based on the data
    svg.selectAll("path")
      .data(json.features)
      .enter()
      .append("path")
      .attr("d", path)
      .style("fill", function(d) {
        var valueObj = data.find(obj => obj.geo == d.properties.ISO2);
        var value = valueObj ? valueObj.value : 0;
        if (value) {
          return color(value);
        } else {
          return "#ccc";
        }
      })
      .style("stroke", "white")
      .style("stroke-width", 1.5)
      // Add a mouseover event to show a tooltip with country name and data value
      .on("mouseover", function(event, d) {
        d3.select(this).style("stroke", "black");
        var valueObj = data.find(obj => obj.geo == d.properties.ISO2);
        var value = valueObj ? valueObj.value : "N/A";
        d3.select("#tooltip")
          .style("display", "block")
          .html(`<strong>${d.properties.NAME}</strong><br/>Immigration: ${value}`);
      })
      // Add a mouseout event to hide the tooltip
      .on("mouseout", function() {
        d3.select(this).style("stroke", "white");
        d3.select("#tooltip").style("display", "none");
      });

    // Create a tooltip element
    var tooltip = d3.select("#map-container")
      .append("div")
      .attr("class", "tooltip");

      selectedYear = this.value;

// Define the color legend data
var legendData = color.ticks(6);

// Create a color legend SVG container with the specified width and height
var legendWidth = 1300;
var legendHeight = 50;
var legendSvg = d3.select("#legend-container")
  .append("svg")
  .attr("width", legendWidth)
  .attr("height", legendHeight);

// Create a color legend group and position it
var legend = legendSvg.append("g")
  .attr("transform", "translate(20,20)");

// Create color legend rectangles
legend.selectAll("rect")
  .data(legendData)
  .enter()
  .append("rect")
  .attr("x", function(d, i) { return i * (legendWidth / legendData.length); })
  .attr("y", 0)
  .attr("width", legendWidth / legendData.length)
  .attr("height", legendHeight - 20)
  .attr("fill", function(d) { return color(d); });

// Create color legend text labels
legend.selectAll("text")
  .data(legendData)
  .enter()
  .append("text")
  .attr("x", function(d, i) { return i * (legendWidth / legendData.length) + 5; })
  .attr("y", legendHeight - 30)
  .attr("text-anchor", "start")
  .attr("dy", ".35em")
  .style("font-size", "16px")
  .text(function(d, i) {
      if (i === 0) {
          return "<" + d;
      } else if (i === legendData.length - 1) {
          return ">" + d;
      } else {
          return d + " - " + legendData[i + 1];
      }
  });


  var legendTitle = legendSvg.append("text")
  .attr("x", legendWidth / 2)
  .attr("y", 15)
  .attr("text-anchor", "middle")
  .style("font-size", "18px")
  .attr("fill", "white")
  .text("Immigration Legend for 2012");


d3.select("#year").on("change", function() {
  // When the year selection changes:
  selectedYear = this.value;

  filteredData = csvData.filter(d => d.TIME_PERIOD === selectedYear);

  dataMap = d3.group(filteredData, d => d.geo);
  // Filter the data based on the selected year and group by country
  data = Array.from(dataMap, ([geo, values]) => ({
    geo: geo,
    value: +values[0].value
  }));
  // Create a new array with the filtered data values for each country

  color.domain(d3.extent(data, d => d.value));
  // Update the color scale domain based on the new data values

    // Update the legend data based on the new color scale domain
    legendData = color.ticks(6);

// Re-bind the data to the legend elements
var legendRects = legend.selectAll("rect")
  .data(legendData);

var legendTexts = legend.selectAll("text")
  .data(legendData);

// Remove any old legend elements that are no longer needed
legendRects.exit().remove();
legendTexts.exit().remove();

// Create new legend elements for any new data points
legendRects.enter()
  .append("rect")
  .merge(legendRects)
  .attr("x", function(d, i) { return i * (legendWidth / legendData.length); })
  .attr("y", 0)
  .attr("width", legendWidth / legendData.length)
  .attr("height", legendHeight - 20)
  .attr("fill", function(d) { return color(d); });

legendTexts.enter()
  .append("text")
  .merge(legendTexts)
  .attr("x", function(d, i) { return i * (legendWidth / legendData.length) + 5; })
  .attr("y", legendHeight - 30)
  .attr("text-anchor", "start")
  .attr("dy", ".35em")
  .style("font-size", "16px")
  .text(function(d, i) {
    if (i === 0) {
      return "<" + d;
    } else if (i === legendData.length - 1) {
      return ">" + d;
    } else {
      return d + " - " + legendData[i + 1];
    }
  });

  svg.selectAll("path")
    .data(json.features)
    .transition()
    .duration(500)
    .style("fill", function(d) {
      const valueObj = data.find(obj => obj.geo === d.properties.ISO2);
      const value = valueObj ? valueObj.value : 0;
      if (value) {
        return color(value);
      } else {
        return "#ccc";
      }
      // Update the fill color of each country based on its new value
    });

    // Update the legend title text
  legendTitle.text("Immigration Legend for " + selectedYear);
  });  
 });
});

            </script>

        <h4>What is Cost of Living and Local Purchasing Power?</h4>
        <p>To understand why Singapore has gotten it rating, first we should try to understand what this means. As a stated before the Cost of Living Index measures the price change of goods and services 
           and The Local Purchasing Power shows relative purchasing power in buying goods and services. As started on Investopedia "Purchasing power loss or gain refers to the decrease or increase in how much consumers can buy. Consumers lose purchasing power when prices increase. They gain purchasing power when prices decrease.". 
           </p><p>
           It might of been a bit hard to see the exact values but the site states that the CoL Index was 84.0 and the Local Purchasing Power was 91.3.
           So what does it mean?. Singapore's Cost of Living means that the cost for purchasing essentials is quite high. This could lead to multiple reasons such as food, rent and purchasing power.
           When digging deeper into the cost of living we can see that food partially is responsible since within the index it includes a Groceries Index which sits at 77.08 which is higher than average. 
           This is due to Singapore having 90% of food imported, since Singapore has limited space to work with, the best outcome was to have food imported so that they aren't giving up land. Another factor was rent,
           since the area of space Singapore has to work with is quite small, finding a place to stay can be quite difficult let alone keeping it. This would explain why their Rent Index is at 66.43, encouraging the idea that living in the city is expensive.
        </p><p>
           So how does the Local Purchasing Power come in, well it establishes that most people living Singapore can cover their costs and have more spending opportunities. So while food and rent may be higher than other countries, their wages allow them to cover it. 
           Another small index within the Local Purchasing Power is the Consumer Price Index which measures the change in the price basket of goods and services consumed by households. These can be the expenses that the day to day activities a Singapore citizen does. 
           Singapore's CPI was 112 in February which is quite high. A high CPI usually leads to higher inflation rates which could lead to the Local Purchasing Power to decrease, leading to less spending chances.
        <br>
            This overall leads to Singapore to be sitting in the middle of the Cost of Living Index which quite good, since the limited amount of space prevents them from doing much, it is impressive to see how most citizens are able to find a place to stay and eat while those prices continue to increase.
            We will now look more into how much it costs to live in one of these area's in Singapore from the graph below.
        </p>


<h2 id="conclusion"> Conclusion</h2>
<p>What our final thoughts are, but make it so we did copy from our process book)
</p>

<h2 id='references'>References</h2>
<p> Where the references will go</p>

<p>
    Name: Luca Agnos<br>
    Student ID: 104005588<br>

    (partner info here)
</p>

<footer>COS30045 Data Visualisation </footer>
</body>
</html>